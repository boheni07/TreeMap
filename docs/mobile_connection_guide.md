# 스마트폰-서버 연동 및 전송 오류 해결 가이드

Vercel 배포본(`https://...`)에서 로컬 PC 서버(`http://...`)로 데이터를 전송할 때 발생하는 오류를 해결하기 위한 체크리스트입니다.

## 1. 최우선 확인 사항: 브라우저 보안 정책 (HTTPS → HTTP)
Vercel은 **HTTPS** 보안 연결을 사용하지만, 로컬 PC 서버는 보통 **HTTP**입니다. 브라우저는 보안상의 이유로 HTTPS 사이트에서 HTTP 서버로 데이터를 보내는 것을 차단합니다 (Mixed Content).

### [해결 방법: 크롬(Android)]
1. 크롬 주소창 옆의 **'설정 아이콘(줄 세 개 또는 점 세 개)'** 또는 주소창 왼쪽의 **'기능 설정 버튼'**을 누릅니다.
2. **[사이트 설정]** → **[안전하지 않은 콘텐츠]**를 찾습니다.
3. 해당 항목을 **'허용'**으로 변경합니다.
4. 페이지를 **새로고침**한 후 다시 전송을 시도합니다.

### [해결 방법: 사파리(iOS/iPhone)]
1. 아이폰 **[설정]** → **[Safari]** → **[고급]**으로 이동합니다.
2. 현재로서는 사파리에서 직접적인 허용이 까다로울 수 있으므로, 가급적 아이폰에서도 **Chrome 앱**을 설치하여 위 설정을 적용하는 것을 권장합니다.

---

## 2. 네트워크 연결 확인
스마트폰과 PC가 서로를 찾을 수 있는 상태여야 합니다.

1. **같은 Wi-Fi 사용**: 스마트폰과 PC는 반드시 동일한 Wi-Fi 공유기에 연결되어 있어야 합니다. (LTE/5G 모드에서는 작동하지 않습니다.)
2. **IP 주소 재확인**: PC에서 터미널을 열고 `ipconfig`를 입력하여 `IPv4 주소`가 서버 설정의 IP(`172.30.1.90`)와 일치하는지 확인하세요.

---

## 3. PC 방화벽 설정 (Windows)
PC의 방화벽이 스마트폰의 접근을 막고 있을 수 있습니다.

1. **[제어판]** → **[시스템 및 보안]** → **[Windows Defender 방화벽]** → **[고급 설정]**으로 이동합니다.
2. **[인바운드 규칙]** → **[새 규칙]**을 클릭합니다.
3. **[포트]** 선택 → **[TCP]** / **[특정 로컬 포트: 8000]** 입력.
4. **[연결 허용]**을 선택하고 이름을 'TreeMap API'로 저장합니다.

---

## 4. 서버(FastAPI) 실행 상태 확인
서버가 127.0.0.1이 아닌 **0.0.0.0**으로 실행 중이어야 외부 접근이 가능합니다.

- 현재 서버는 다음 명령으로 정상 실행 중입니다:
  `python -m uvicorn main:app --host 0.0.0.0 --port 8000`

---

## 5. 실시간 데이터 전송 방법 (Step-by-Step)

스마트폰에서 데이터를 측정하고 서버로 전송하는 구체적인 순서입니다.

1. **사이트 접속**: 스마트폰 브라우저에서 Vercel 주소(`https://...`) 또는 로컬 접속 주소(`http://172.30.1.90:5173`)에 접속합니다.
2. **서버 IP 설정**: 좌측 상단의 **[서버 접속 설정] (톱니바퀴 아이콘)** 버튼을 누릅니다.
    - **Vercel로 전송할 경우**: `tree-map-sigma.vercel.app` (포트번호 없이 도메인만) 입력 후 저장.
    - **로컬 PC로 전송할 경우**: PC의 IP 주소(예: `172.30.1.90`) 입력 후 저장.
3. **측정 준비**: 스마트폰을 나무 정면을 향해 세웁니다. 화면 중앙의 **물방울 수평계**가 녹색이 되도록 기울기를 조절합니다.
4. **데이터 캡처**: 수평이 맞으면 하단의 **[카메라 아이콘] (READY 상태)**을 클릭합니다.
5. **전송 확인**: 촬영 즉시 데이터 분석이 수행되며, 자동으로 "분석 데이터가 서버로 전송되었습니다"라는 메시지가 나타납니다.
6. **대시보드 확인**: PC에서 `/admin` 페이지(지동 대시보드)를 새로고침하면 방금 전송된 나무 마커가 지도에 나타납니다.
